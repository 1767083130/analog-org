/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Dec 20 14:19
*/
KISSY.add("ajax",function(c,e,i){function k(b,f,g,a,l){c.isFunction(f)&&(a=g,g=f,f=h);return i({type:l||"get",url:b,data:f,success:g,dataType:a})}var h=void 0;c.mix(i,{serialize:e.serialize,get:k,post:function(b,f,g,a){c.isFunction(f)&&(a=g,g=f,f=h);return k(b,f,g,a,"post")},jsonp:function(b,f,g){c.isFunction(f)&&(g=f,f=h);return k(b,f,g,"jsonp")},getScript:c.getScript,getJSON:function(b,f,g){c.isFunction(f)&&(g=f,f=h);return k(b,f,g,"json")},upload:function(b,f,g,a,l){c.isFunction(g)&&(l=a,a=g,g=
h);return i({url:b,type:"post",dataType:l,form:f,data:g,success:a})}});c.mix(c,{Ajax:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(c,e,i,k){function h(a){var d=a.context,b=a.ifModified;delete a.context;a=c.mix(c.clone(n),a,{deep:!0});a.context=d||a;var l,f=a.type,h=a.dataType,o;o=a.query=new c.Uri.Query;d=a.uri=q.resolve(a.url);"crossDomain"in a||(a.crossDomain=!a.uri.hasSameDomainAs(q));if(a.processData&&(l=a.data))c.isObject(l)?o.add(l):o.reset(l);f=a.type=f.toUpperCase();a.hasContent=!j.test(f);h=a.dataType=c.trim(h||"*").split(g);!("cache"in a)&&c.inArray(h[0],["script","jsonp"])&&(a.cache=
!1);var e;a.hasContent||(o.count()&&d.query.add(o),b&&(e=d.clone()),!1===a.cache&&d.query.set("_ksTS",c.now()+"_"+c.guid()));b&&(a.ifModifiedKeyUri=e||d.clone());return a}function b(a,j){f.fire(a,{ajaxConfig:j.config,xhr:j,io:j})}function f(a){function j(l){return function(j){if(e=d.timeoutTimer)clearTimeout(e),d.timeoutTimer=0;var f=a[l];f&&f.apply(s,j);b(l,d)}}var d=this;if(!a.url)return k;if(!(d instanceof f))return new f(a);l.call(d);a=h(a);c.mix(d,{responseData:null,config:a||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)});var g;b("start",d);g=new (r[a.dataType[0]]||r["*"])(d);d.transport=g;a.contentType&&d.setRequestHeader("Content-Type",a.contentType);var o=a.dataType[0],e,m,i=a.timeout,s=a.context,q=a.headers,n=a.accepts;d.setRequestHeader("Accept",o&&n[o]?n[o]+("*"===o?"":", */*; q=0.01"):n["*"]);for(m in q)q.hasOwnProperty(m)&&
d.setRequestHeader(m,q[m]);if(a.beforeSend&&!1===a.beforeSend.call(s,d,a))return k;d.then(j("success"),j("error"));d.fin(j("complete"));d.readyState=1;b("send",d);a.async&&0<i&&(d.timeoutTimer=setTimeout(function(){d.abort("timeout")},1E3*i));try{d.state=1,g.send()}catch(p){2>d.state&&d._ioReady(-1,p)}return k}var g=/\s+/,a=function(a){return a},l=c.Promise,j=/^(?:GET|HEAD)$/,d,o=c.Uri,s=c.Env.host,m=s.document,s=s.location,q;try{d=s.href}catch(p){d=m.createElement("a"),d.href="",d=d.href}q=new o(d);
d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/.test(q.getScheme());var r={},n={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:e.parse,html:a,text:a,xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};n.converters.html=n.converters.text;c.mix(f,i.Target);c.mix(f,
{isLocal:d,setupConfig:function(a){c.mix(n,a,{deep:!0})},setupTransport:function(a,d){r[a]=d},getTransport:function(a){return r[a]},getConfig:function(){return n}});return f},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(c,e){function i(b){return b.replace(h,"\r\n")}var k=/^(?:select|textarea)/i,h=/\r?\n/g,b,f=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return b={serialize:function(f,a){return c.param(b.getFormData(f),void 0,void 0,a||!1)},getFormData:function(b){var a=[],l={};c.each(e.query(b),function(j){j=j.elements?c.makeArray(j.elements):[j];a.push.apply(a,j)});a=c.filter(a,function(a){return a.name&&!a.disabled&&
(a.checked||k.test(a.nodeName)||f.test(a.type))});c.each(a,function(a){var d=e.val(a),b,d=c.isArray(d)?c.map(d,i):i(d);(b=l[a.name])?(b&&!c.isArray(b)&&(b=l[a.name]=[b]),b.push.apply(b,c.makeArray(d))):l[a.name]=d});return l}}},{requires:["dom"]});
KISSY.add("ajax/form",function(c,e,i,k){e.on("start",function(c){var b,f,c=c.io.config;if(b=c.form)b=i.get(b),f=b.encoding||b.enctype,"multipart/form-data"!=f.toLowerCase()?(b=k.getFormData(b),c.hasContent?c.query.add(b):(c.uri.query.add(b),c.ifModifiedKeyUri&&c.ifModifiedKeyUri.query.add(b))):(b=c.dataType,c=b[0],"*"==c&&(c="text"),b.length=2,b[0]="iframe",b[1]=c)});return e},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(c,e,i,k){function h(a){var b=c.guid("ajax-iframe"),j=e.getEmptyIframeSrc(),a=a.iframe=e.create("<iframe "+(j?' src="'+j+'" ':"")+' id="'+b+'" name="'+b+'" style="position:absolute;left:-9999px;top:-9999px;"/>');e.prepend(a,g.body||g.documentElement);return a}function b(a,b,j){var d=[],f,h,m,i,k=a.keys();c.each(k,function(k){var n=a.get(k);f=c.isArray(n);h=c.makeArray(n);for(m=0;m<h.length;m++)i=g.createElement("input"),i.type="hidden",i.name=k+(f&&j?"[]":
""),i.value=h[m],e.append(i,b),d.push(i)});return d}function f(a){this.io=a}var g=c.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});c.augment(f,{send:function(){var a=this,c=a.io,j=c.config,d,f,g=j.query,m=e.get(j.form);a.attrs={target:e.attr(m,"target")||"",action:e.attr(m,"action")||"",method:e.attr(m,"method")};a.form=m;f=h(c);e.attr(m,{target:f.id,action:j.uri.toString(j.serializeArray),
method:"post"});g.count()&&(d=b(g,m,j.serializeArray));a.fields=d;setTimeout(function(){i.on(f,"load error",a._callback,a);m.submit()},10)},_callback:function(a){var b=this.io,a=a.type,j=b.iframe;if(j)if(e.attr(this.form,this.attrs),e.remove(this.fields),i.detach(j),setTimeout(function(){e.remove(j)},30),b.iframe=null,"load"==a){if((a=j.contentWindow.document)&&a.body)b.responseText=c.trim(e.text(a.body)),c.startsWith(b.responseText,"<?xml")&&(b.responseText=void 0);b.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;b._ioReady(200,"success")}else"error"==a&&b._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",f);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(c,e){var i=c.Env.host;e.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});e.on("start",function(e){var h=e.io,b=h.config,e=b.dataType;if("jsonp"==e[0]){var f,g=b.jsonpCallback,a=c.isFunction(g)?g():g,l=i[a];b.uri.query.set(b.jsonp,a);i[a]=function(a){1<arguments.length&&(a=c.makeArray(arguments));f=[a]};h.fin(function(){i[a]=l;if(void 0===l)try{delete i[a]}catch(b){}else f&&l(f[0])});h=h.converters=h.converters||{};h.script=h.script||
{};h.script.json=function(){return f[0]};e.length=2;e[0]="script";e[1]="json"}});return e},{requires:["./base"]});
KISSY.add("ajax/methods",function(c,e,i){function k(b){var f=b.responseText,g=b.responseXML,a=b.config,l=a.converters,j=b.converters||{},d,e,h=a.contents,m=a.dataType;if(f||g){for(a=b.mimeType||b.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(d in h)if(h.hasOwnProperty(d)&&h[d].test(a)){m[0]!=d&&m.unshift(d);break}m[0]=m[0]||"text";if("text"==m[0]&&f!==i)e=f;else if("xml"==m[0]&&g!==i)e=g;else{var k={text:f,xml:g};c.each(["text","xml"],function(a){var d=m[0];if((j[a]&&j[a][d]||
l[a]&&l[a][d])&&k[a])return m.unshift(a),e="text"==a?f:g,!1})}}h=m[0];for(a=1;a<m.length;a++){d=m[a];var p=j[h]&&j[h][d]||l[h]&&l[h][d];if(!p)throw"no covert for "+h+" => "+d;e=p(e);h=d}b.responseData=e}var h=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;c.extend(e,c.Promise,{setRequestHeader:function(b,c){this.requestHeaders[b]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(b){var c,g;if(2===this.state){if(!(g=this.responseHeaders))for(g=
this.responseHeaders={};c=h.exec(this.responseHeadersString);)g[c[1]]=c[2];c=g[b]}return c===i?null:c},overrideMimeType:function(b){this.state||(this.mimeType=b);return this},abort:function(b){b=b||"abort";this.transport&&this.transport.abort(b);this._ioReady(0,b);return this},getNativeXhr:function(){var b;if(b=this.transport)return b.nativeXhr},_ioReady:function(b,c){if(2!=this.state){this.state=2;this.readyState=4;var g;if(200<=b&&300>b||304==b)if(304==b)c="not modified",g=!0;else try{k(this),c=
"success",g=!0}catch(a){c="parser error"}else 0>b&&(b=0);this.status=b;this.statusText=c;this._defer[g?"resolve":"reject"]([this.responseData,c,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(c,e,i,k){function h(b){if(!b.config.crossDomain)return new (e.getTransport("*"))(b);this.io=b;return 0}var b=c.Env.host,f=b.document;e.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(b){c.globalEval(b);return b}}}});c.augment(h,{send:function(){var c=this,a,l=c.io.config,j=f.head||f.getElementsByTagName("head")[0]||
f.documentElement;c.head=j;a=f.createElement("script");c.script=a;a.async="async";l.scriptCharset&&(a.charset=l.scriptCharset);a.src=l.uri.toString(l.serializeArray);a.onerror=a.onload=a.onreadystatechange=function(a){a=a||b.event;c._callback((a.type||"error").toLowerCase())};j.insertBefore(a,j.firstChild)},_callback:function(b,a){var c=this.script,j=this.io,d=this.head;if(c&&(a||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==b))c.onerror=c.onload=c.onreadystatechange=null,d&&c.parentNode&&
d.removeChild(c),this.head=this.script=k,!a&&"error"!=b?j._ioReady(200,"success"):"error"==b&&j._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});e.setupTransport("script",h);return e},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(c,e,i,k){function h(a){var b=a.config;this.io=a;b.crossDomain=!1}function b(){var a=this.io.config.uri.getHostname(),a=g[a];a.ready=1;i.detach(a.iframe,"load",b,this);this.send()}var f=c.Env.host.document,g={};c.augment(h,e.proto,{send:function(){var a=this.io.config,l=a.uri,j=l.getHostname(),d;d=g[j];var h="/sub_domain_proxy.html";a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(h=a.xdr.subDomain.proxy);d&&d.ready?(this.nativeXhr=e.nativeXhr(0,d.iframe.contentWindow))&&
this.sendInternal():(d?a=d.iframe:(d=g[j]={},a=d.iframe=f.createElement("iframe"),k.css(a,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(a,f.body||f.documentElement),d=new c.Uri,d.setScheme(l.getScheme()),d.setHostname(j),d.setPath(h),a.src=d.toString()),i.on(a,"load",b,this))}});return h},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(c,e,i){function k(b,d,c){l||(l=!0,b='<object id="'+f+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+d+"&uid="+c+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',d=a.createElement("div"),i.prepend(d,a.body||a.documentElement),d.innerHTML=b)}function h(a){this.io=a}var b={},f="io_swf",g,a=c.Env.host.document,l=
!1;c.augment(h,{send:function(){var a=this,d=a.io.config;k((d.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);g?(a._uid=c.guid(),b[a._uid]=a,g.send(d.uri.toString(d.serializeArray),{id:a._uid,uid:a._uid,method:d.type,data:d.hasContent&&d.query.toString(d.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){g.abort(this._uid)},_xdrResponse:function(a,d){var c,f=d.id,e=this.io;e.responseText=decodeURI(d.c.responseText);switch(a){case "success":c={status:200,statusText:"success"};
delete b[f];break;case "abort":delete b[f];break;case "timeout":case "transport error":case "failure":delete b[f],c={status:500,statusText:a}}c&&e._ioReady(c.status,c.statusText)}});e.applyTo=function(a,d,b){var a=d.split(".").slice(1),f=e;c.each(a,function(a){f=f[a]});f.apply(null,b)};e.xdrReady=function(){g=a.getElementById(f)};e.xdrResponse=function(a,d){var c=b[d.uid];c&&c._xdrResponse(a,d)};return h},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(c,e){function i(a,c){try{return new (c||k).XMLHttpRequest}catch(b){}}var k=c.Env.host,h=k.XDomainRequest,b={proto:{}},f={},g={};e.__lastModifiedCached=f;e.__eTagCached=g;b.nativeXhr=k.ActiveXObject?function(a,c){var b;if(a&&h)b=new h;else if(!(b=!e.isLocal&&i(a,c)))a:{try{b=new (c||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}b=void 0}return b}:i;c.mix(b.proto,{sendInternal:function(){var a=this,b=a.io,c=b.config,d=a.nativeXhr,e=c.type,i=c.async,
m,k=c.crossDomain,p=b.mimeType,b=b.requestHeaders||{},r=c.serializeArray,n=c.uri.toString(r),v,u,t;if(v=c.ifModifiedKeyUri&&c.ifModifiedKeyUri.toString()){if(u=f[v])b["If-Modified-Since"]=u;if(u=g[v])b["If-None-Match"]=u}(m=c.username)?d.open(e,n,i,m,c.password):d.open(e,n,i);if(e=c.xhrFields)for(t in e)e.hasOwnProperty(t)&&(d[t]=e[t]);p&&d.overrideMimeType&&d.overrideMimeType(p);!k&&!b["X-Requested-With"]&&(b["X-Requested-With"]="XMLHttpRequest");try{if(!k)for(t in b)b.hasOwnProperty(t)&&d.setRequestHeader(t,
b[t])}catch(w){}d.send(c.hasContent&&c.query.toString(r)||null);!i||4==d.readyState?a._callback():h&&d instanceof h?(d.onload=function(){d.readyState=4;d.status=200;a._callback()},d.onerror=function(){d.readyState=4;d.status=500;a._callback()}):d.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,b){try{var e=this.nativeXhr,d=this.io,i=d.config;if(b||4==e.readyState)if(h&&e instanceof h?(e.onerror=c.noop,e.onload=c.noop):e.onreadystatechange=c.noop,
b)4!==e.readyState&&e.abort();else{var k=i.ifModifiedKeyUri&&i.ifModifiedKeyUri.toString(),m=e.status;h&&e instanceof h||(d.responseHeadersString=e.getAllResponseHeaders());if(k){var q=e.getResponseHeader("Last-Modified"),p=e.getResponseHeader("ETag");q&&(f[k]=q);p&&(g[p]=p)}var r=e.responseXML;r&&r.documentElement&&(d.responseXML=r);d.responseText=e.responseText;try{var n=e.statusText}catch(v){n=""}!m&&d.isLocal&&!i.crossDomain?m=d.responseText?200:404:1223===m&&(m=204);d._ioReady(m,n)}}catch(u){e.onreadystatechange=
c.noop,b||d._ioReady(-1,u)}}});return b},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(c,e,i,k,h,b){var f=c.Env.host,g=f.XDomainRequest,a=i.nativeXhr();if(a){var l=function(e){var d=e.config,l=d.crossDomain,s=d.xdr||{};if(l){d=d.uri.getHostname();if(c.endsWith(d,f.document.domain))return new k(e);if(!("withCredentials"in a)&&("flash"===""+s.use||!g))return new h(e)}this.io=e;this.nativeXhr=i.nativeXhr(l);return b};c.augment(l,i.proto,{send:function(){this.sendInternal()}});e.setupTransport("*",l)}return e},{requires:["./base","./xhr-transport-base",
"./sub-domain-transport","./xdr-flash-transport"]});
