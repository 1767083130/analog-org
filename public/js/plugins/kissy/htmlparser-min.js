/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Nov 5 11:41
*/
KISSY.add("htmlparser/Parser",function(b,d,h,g,a,j,l,i){function e(c,k){this.originalHtml=c=b.trim(c);c=/^(<!doctype|<html|<body)/i.test(c)?"<document>"+c+"</document>":"<body>"+c+"</body>";this.lexer=new j(c);this.opts=k||{}}function f(c){var k=q(c,"body",3);if(k){var c=k.parentNode,e=c.childNodes,a=b.indexOf(k,e);if(a!=e.length-1){e=e.slice(a+1,e.length);for(a=0;a<e.length;a++)c.removeChild(e[a]),"body"==e[a].tagName?b.each(e[a].childNodes,function(c){k.appendChild(c)}):k.appendChild(e[a])}}return k}
function c(c){var k=c.childNodes,e,a,b=d.p,j=0;for(a=0;a<k.length;a++)if(e=k[a],3==e.nodeType||1==e.nodeType&&b[e.nodeName]){j=1;break}if(j){var j=[],q=new h;q.nodeName=q.tagName="p";for(a=0;a<k.length;a++)e=k[a],3==e.nodeType||1==e.nodeType&&b[e.nodeName]?q.appendChild(e):(q.childNodes.length&&(j.push(q),q=q.clone()),j.push(e));q.childNodes.length&&j.push(q);c.empty();for(a=0;a<j.length;a++)c.appendChild(j[a])}}function q(c,k,e){if(0===e)return 0;b.isNumber(e)&&e--;var a=c.childNodes;if(a)for(var j=
0;j<a.length;j++){if(a[j].tagName===k)return a[j];if(c=q(a[j],k,e))return c}return 0}function k(c){for(var k=[].concat(c.childNodes),a=0;a<k.length;a++)if("html"==k[a].nodeName){for(var e=k[a],j=0;j<a;j++)3==k[j].nodeType&&!b.trim(k[j].toHtml())&&c.removeChild(k[j]);for(;e.firstChild&&3==e.firstChild.nodeType&&!b.trim(e.firstChild.toHtml());)e.removeChild(e.firstChild);break}}e.prototype={elements:function(){var a,e,j=this.lexer,q=this.opts;e=a=j.nextNode();"document"!=a.tagName&&(e=new l,e.appendChild(a));
e.nodeType=9;i.getScanner("div").scan(a,j,q);(a=f(e))&&q.autoParagraph&&c(a);k(e);var q=this.originalHtml,d=new g;e=/^(<!doctype|<html|<body)/i.test(q)?e.childNodes:a.childNodes;b.each(e,function(c){d.appendChild(c)});return d},parse:function(){return this.elements()}};return e},{requires:"./dtd,./nodes/Tag,./nodes/Fragment,./lexer/Cursor,./lexer/Lexer,./nodes/Document,./Scanner".split(",")});
KISSY.add("htmlparser/Scanner",function(b,d,h){return{getScanner:function(b){return h[b]||d}}},{requires:["./scanners/TagScanner","./scanners/SpecialScanners","./scanners/QuoteCdataScanner","./scanners/TextareaScanner"]});
KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(b){return b.replace(/[\s\xa0]+/g," ")},isLetter:function(b){return"a"<=b&&"z">=b||"A"<=b&&"Z">=b},isValidAttributeNameStartChar:function(b){return!this.isWhitespace(b)&&'"'!=b&&"'"!=b&&">"!=b&&"<"!=b&&"/"!=b&&"="!=b},isWhitespace:function(b){return/^[\s\xa0]$/.test(b)}}});
KISSY.add("htmlparser/dtd",function(b){var b=b.merge,d={isindex:1,fieldset:1},h={input:1,button:1,select:1,textarea:1,label:1},g=b({a:1},h),a=b({iframe:1},g),j={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},l={ins:1,del:1,script:1,style:1},i=b({b:1,acronym:1,bdo:1,"var":1,"#text":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},l),e=b({sub:1,img:1,object:1,
sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1},i),f=b({p:1},e),h=b({iframe:1},e,h),e={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#text":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,
u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1},c=b({a:1},h),q={tr:1},k={"#text":1},u=b({param:1},e),p=b({form:1},d,a,j,f),n={li:1},m={base:1,link:1,meta:1,title:1},r=b(m,{style:1,script:1}),s={head:1,body:1},o={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},b={$nonBodyContent:b({html:1},s,m),$block:o,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:c,$body:b({script:1,style:1},
o),$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,
select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:s,head:r,style:k,body:p,base:{},link:{},meta:{},title:k,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:p,td:p,br:{},th:p,center:p,kbd:c,button:b(f,j),basefont:{},h5:c,h4:c,samp:c,h6:c,ol:n,h1:c,h3:c,option:k,h2:c,form:b(d,a,j,f),select:{optgroup:1,option:1},font:c,ins:c,menu:n,abbr:c,label:c,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:c,script:k,tfoot:q,cite:c,
li:p,input:{},iframe:p,strong:c,textarea:k,noframes:p,big:c,small:c,span:c,hr:{},dt:c,sub:c,optgroup:{option:1},param:{},bdo:c,"var":c,div:p,object:u,sup:c,dd:p,strike:c,area:{},dir:n,map:b({area:1,form:1,p:1},d,l,j),applet:u,dl:{dt:1,dd:1},del:c,isindex:{},fieldset:b({legend:1},e),thead:q,ul:n,acronym:c,b:c,a:h,blockquote:p,caption:c,i:c,u:c,tbody:q,s:c,address:b(a,f),tt:c,legend:c,q:c,pre:b(i,g),p:c,em:c,dfn:c},g="article,figure,nav,aside,section,footer".split(","),t;for(t in b)for(var v in b[t])if("div"==
v)for(d=0;d<g.length;d++)b[t][g[d]]=b[t][v];for(d=0;d<g.length;d++)b[g[d]]=b.div;b.$empty["!doctype"]=1;return b});KISSY.add("htmlparser",function(b,d,h,g,a,j,l,i,e,f,c,q,k){return{CData:e,Comment:f,Node:c,Tag:q,Text:k,Lexer:h,Parser:g,BasicWriter:a,BeautifyWriter:j,MinifyWriter:l,Filter:i,DTD:d,serialize:function(c,e){var k=new a;c.writeHtml(k,e);return k.getHtml()},parse:function(c){return(new g(c)).parse()}}},{requires:"htmlparser/dtd,htmlparser/lexer/Lexer,htmlparser/Parser,htmlparser/writer/basic,htmlparser/writer/beautify,htmlparser/writer/minify,htmlparser/writer/filter,htmlparser/nodes/CData,htmlparser/nodes/Comment,htmlparser/nodes/Node,htmlparser/nodes/Tag,htmlparser/nodes/Text".split(",")});
KISSY.add("htmlparser/lexer/Cursor",function(){function b(b){this.position=b||0}b.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return b});
KISSY.add("htmlparser/lexer/Index",function(){function b(){this.lineCursors=[]}function d(b,a){for(var j=0;j<b.length;j++)if(b[j].position===a.position)return j;return-1}function h(b,a){for(var j=0;j<b.length&&!(b[j].position>a.position);j++);return j}b.prototype={add:function(b){-1==d(this.lineCursors,b)&&this.lineCursors.splice(h(this.lineCursors,b),0,b)},remove:function(b){var a=this.lineCursors,b=d(this.lineCursors,b);-1!=b&&a.splice(b,1)},row:function(b){return h(this.lineCursors,b)-1},col:function(b){var a=
h(this.lineCursors,b)-1;return b.position-this.lineCursors[a]}};return b});
KISSY.add("htmlparser/lexer/Lexer",function(b,d,h,g,a,j,l,i,e){function f(c){this.page=new h(c);this.cursor=new d;this.nodeFactory=this}f.prototype={setPosition:function(c){this.cursor.position=c},getPosition:function(){return this.cursor.position},nextNode:function(c){var e,k,a=this.cursor,b=this.page;e=a.position;k=b.getChar(a);switch(k){case -1:c=null;break;case "<":k=b.getChar(a);-1==k?c=this.makeString(e,a.position):"/"==k||j.isLetter(k)?(b.ungetChar(a),c=this.parseTag(e)):"!"==k||"?"==k?(k=
b.getChar(a),-1==k?c=this.makeString(e,a.position):">"==k?c=this.makeComment(e,a.position):(b.ungetChar(a),"-"==k?c=this.parseComment(e,c):(b.ungetChar(a),c=this.parseTag(e)))):(b.ungetChar(a),c=this.parseString(e,c));break;default:b.ungetChar(a),c=this.parseString(e,c)}return c},makeComment:function(c,e){var a;a=e-c;if(0!=a){if(2>a)return this.makeString(c,e);a=this.nodeFactory.createCommentNode(this.page,c,e)}else a=null;return a},makeString:function(c,a){var e=null;0<a-c&&(e=this.nodeFactory.createStringNode(this.page,
c,a));return e},makeCData:function(c,a){var e=null;0<a-c&&(e=this.nodeFactory.createCDataNode(this.page,c,a));return e},makeTag:function(c,a,e){var b;b=a-c;if(0!=b){if(2>b)return this.makeString(c,a);c=this.nodeFactory.createTagNode(this.page,c,a,e)}else c=null;return c},createTagNode:function(c,a,e,b){return new i(c,a,e,b)},createStringNode:function(c,a,e){return new g(c,a,e)},createCDataNode:function(c,e,k){return new a(c,e,k)},createCommentNode:function(c,a,k){return new e(c,a,k)},parseTag:function(c){var a,
e=[],b=[],f,g=this.page,m=0,d=this.cursor;for(e[0]=d.position;!a;)switch(e[m+1]=d.position,f=g.getChar(d),m){case 0:if(-1==f||">"==f||"<"==f)"<"==f&&(g.ungetChar(d),e[m+1]=d.position),a=!0;else if("/"==f||j.isValidAttributeNameStartChar(f))m=1;break;case 1:-1==f||">"==f||"<"==f?("<"==f&&(g.ungetChar(d),e[m+1]=d.getPosition),this.standalone(b,e),a=!0):j.isWhitespace(f)?(e[6]=e[2],m=6):"="==f&&(m=2);break;case 2:-1==f||">"==f?(this.standalone(b,e),a=!0):"'"==f?(m=4,e[4]=e[3]):'"'==f?(m=5,e[5]=e[3]):
j.isWhitespace(f)||(m=3);break;case 3:-1==f||">"==f?(this.naked(b,e),a=!0):j.isWhitespace(f)&&(this.naked(b,e),e[0]=e[4],m=0);break;case 4:-1==f?(this.single_quote(b,e),a=!0):"'"==f&&(this.single_quote(b,e),e[0]=e[5]+1,m=0);break;case 5:-1==f?(this.double_quote(b,e),a=!0):'"'==f&&(this.double_quote(b,e),e[0]=e[6]+1,m=0);break;case 6:-1==f?(this.standalone(b,e),e[0]=e[6],g.ungetChar(d),m=0):j.isWhitespace(f)||("="==f?(e[2]=e[6],e[3]=e[7],m=2):(this.standalone(b,e),e[0]=e[6],g.ungetChar(d),m=0));break;
default:throw Error("how ** did we get in state "+m);}return this.makeTag(c,d.position,b)},parseComment:function(c,e){var a,b,f=this.page,g=this.cursor,d;a=!1;for(d=0;!a;)if(b=f.getChar(g),-1==b)a=!0;else switch(d){case 0:">"==b&&(a=!0);if("-"==b)d=1;else return this.parseString(c,e);break;case 1:if("-"==b)b=f.getChar(g),-1==b?a=!0:">"==b?a=!0:(f.ungetChar(g),d=2);else return this.parseString(c,e);break;case 2:if("-"==b)d=3;else if(-1==b)return this.parseString(c,e);break;case 3:d="-"==b?4:2;break;
case 4:">"==b?a=!0:j.isWhitespace(b)||(d=2);break;default:throw Error("how ** did we get in state "+d);}return this.makeComment(c,g.position)},parseString:function(e,a){for(var b=0,f,d=this.page,g=this.cursor,i=0;!b;)if(f=d.getChar(g),-1==f)b=1;else if(a&&0==i&&("'"==f||'"'==f))i=f;else if(a&&0!=i&&"\\"==f)f=d.getChar(g),-1!=f&&"\\"!=f&&f!=i&&d.ungetChar(g);else if(a&&f==i)i=0;else if(a&&0==i&&"/"==f)if(f=d.getChar(g),-1==f)b=1;else if("/"==f){do f=d.getChar(g);while(-1!=f&&"\n"!=f)}else if("*"==
f){do{do f=d.getChar(g);while(-1!=f&&"*"!=f);f=d.getChar(g);"*"==f&&d.ungetChar(g)}while(-1!=f&&"/"!=f)}else d.ungetChar(g);else if(0==i&&"<"==f)if(f=d.getChar(g),-1==f)b=1;else{if("/"==f||j.isLetter(f)||"!"==f||"?"==f)b=1,d.ungetChar(g);d.ungetChar(g)}return this.makeString(e,g.position)},parseCDATA:function(e,a){var b,f,d,g,i,h,l=this.cursor,o=this.page;b=l.position;f=0;d=!1;g="";for(h=!1;!d;)switch(i=o.getChar(l),f){case 0:switch(i){case -1:d=!0;break;case "'":e&&!h&&(""==g?g="'":"'"==g&&(g=""));
break;case '"':e&&!h&&(""==g?g='"':'"'==g&&(g=""));break;case "\\":e&&""!=g&&(i=o.getChar(l),-1==i?d=!0:"\\"!=i&&i!=g&&o.ungetChar(l));break;case "/":if(e&&""==g)if(i=o.getChar(l),-1==i)d=!0;else if("/"==i)h=!0;else if("*"==i){do{do i=o.getChar(l);while(-1!=i&&"*"!=i);i=o.getChar(l);"*"==i&&o.ungetChar(l)}while(-1!=i&&"/"!=i)}else o.ungetChar(l);break;case "\n":h=!1;break;case "<":e?""==g&&(f=1):f=1}break;case 1:switch(i){case -1:d=!0;break;case "/":f=!a||o.getText(l.position,l.position+a.length)===
a&&!o.getText(l.position+a.length,l.position+a.length+1).match(/\w/)?2:0;break;case "!":i=o.getChar(l);-1==i?d=!0:"-"==i?(i=o.getChar(l),-1==i?d=!0:f="-"==i?3:0):f=0;break;default:f=0}break;case 2:h=!1;-1==i?d=!0:j.isLetter(i)?(d=!0,o.ungetChar(l),o.ungetChar(l),o.ungetChar(l)):f=0;break;case 3:h=!1;-1==i?d=!0:"-"==i&&(i=o.getChar(l),-1==i?d=!0:"-"==i?(i=o.getChar(l),-1==i?d=!0:">"==i?f=0:(o.ungetChar(l),o.ungetChar(l))):o.ungetChar(l));break;default:throw Error("unexpected "+f);}return this.makeCData(b,
l.position)},single_quote:function(e,a){var b=this.page;e.push(new l(b.getText(a[1],a[2]),"=",b.getText(a[4]+1,a[5]),"'"))},double_quote:function(e,a){var b=this.page;e.push(new l(b.getText(a[1],a[2]),"=",b.getText(a[5]+1,a[6]),'"'))},standalone:function(e,a){e.push(new l(this.page.getText(a[1],a[2])))},naked:function(e,a){var b=this.page;e.push(new l(b.getText(a[1],a[2]),"=",b.getText(a[3],a[4])))}};return f},{requires:"./Cursor,./Page,../nodes/Text,../nodes/CData,../Utils,../nodes/Attribute,../nodes/Tag,../nodes/Comment".split(",")});
KISSY.add("htmlparser/lexer/Page",function(b,d){function h(b){this.source=b;this.lineIndex=new d}h.prototype={getChar:function(b){var a=this.source,j=b.position;if(j>=a.length)return-1;var d=a.charAt(j);b.advance();"\r"===d&&(d="\n",j=b.position,"\n"===a.charAt(j)&&b.advance());"\n"===d&&this.lineIndex.add(b);return d},ungetChar:function(b){var a=this.source;b.retreat();var j=b.position,d=a.charAt(j);"\n"===d&&0!=j&&(d=a.charAt(j-1),"\r"===d&&b.retreat())},getText:function(b,a){return this.source.slice(b,
a)},row:function(b){return this.lineIndex.row(b)},col:function(b){return this.lineIndex.col(b)}};return h},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(b){function d(b,d,a,j){this.nodeType=2;this.name=b;this.assignMent=d;this.value=a;this.quote=j}b.augment(d,{clone:function(){var h=new d;b.mix(h,this);return h},equals:function(b){return this.name==b.name&&this.value==b.value&&this.nodeType==b.nodeType}});d.prototype.clone=function(){var h=new d;b.mix(h,this);return h};return d});
KISSY.add("htmlparser/nodes/CData",function(b,d){function h(){h.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}b.extend(h,d,{writeHtml:function(b,a){var j;if(!a||!1!==(j=a.onCData(this)))j&&this!==j?j.writeHtml(b,a):b.cdata(this.toHtml())}});return h},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(b,d){function h(){h.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}b.extend(h,d,{writeHtml:function(b,a){var j;if(!a||!1!==(j=a.onComment(this)))j&&this!==j?j.writeHtml(b,a):b.comment(this.toHtml())},toHtml:function(){if(this.nodeValue)return this.nodeValue;var b=d.superclass.toHtml.apply(this,arguments);return b.substring(4,b.length-3)}});return h},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Document",function(b,d){function h(){this.childNodes=[];this.nodeType=9;this.nodeName="#document"}b.extend(h,d,{writeHtml:function(b,a){this.__filter=a;this._writeChildrenHtml(b)}});return h},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Fragment",function(b,d){function h(){this.childNodes=[];this.nodeType=9;this.nodeName="#fragment"}b.extend(h,d,{writeHtml:function(b,a){this.__filter=a;this.isChildrenFiltered=0;if(a)a.onFragment(this);this._writeChildrenHtml(b)}});return h},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(b){function d(b){var a=0;b.replace(/\n/g,function(){a++});return a}function h(g,a,j){this.parentNode=null;this.page=g;this.startPosition=a;this.endPosition=j;this.nextSibling=this.previousSibling=this.nodeName=null;g&&(this.startLine=d(this.page.getText(0,a)),this.endLine=d(this.page.getText(0,j)));b.Config.debug&&(this.toHtmlContent=this.toHtml())}h.prototype={toHtml:function(){if(this.page&&this.page.getText)return this.page.getText(this.startPosition,
this.endPosition)},toString:function(){var b=[];b.push(this.nodeName+"  [ "+this.startPosition+"|"+this.startLine+" : "+this.endPosition+"|"+this.endLine+" ]\n");b.push(this.toHtml());return b.join("")}};return h});
KISSY.add("htmlparser/nodes/Tag",function(b,d,h,g){function a(e,a,c){e.nodeName=e.tagName=a.toLowerCase();e._updateSelfClosed();b.each(c,function(a,b){e.setAttribute(b,a)})}function j(e,f,c,d){this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=d||[];this.nodeType=1;if(b.isString(e))a.apply(null,[this].concat(b.makeArray(arguments)));else{j.superclass.constructor.apply(this,arguments);d=this.attributes;d[0]&&(this.nodeName=d[0].name.toLowerCase(),this.tagName=this.nodeName.replace(/\//,
""),this._updateSelfClosed(),d.splice(0,1));var i=d[d.length-1];if(i=!(!i||!/\/$/.test(i.name)))d.length-=1;this.closed=this.isSelfClosed=this.isSelfClosed||i}this.closedEndPosition=this.closedStartPosition=-1}function l(e){var a=e.childNodes;e.firstChild=a[0];e.lastChild=a[a.length-1];1<=a.length&&(a[0].nextSibling=a[0].nextSibling=null,a[0].parentNode=e);if(1<a.length){for(var b=0;b<a.length-1;b++)a[b].nextSibling=a[b+1],a[b+1].previousSibling=a[b],a[b+1].parentNode=e;a[a.length-1].nextSibling=
null}}function i(a,b){for(var c=0;c<a.length;c++)if(a[c].name==b)return a[c];return null}b.extend(j,d,{_updateSelfClosed:function(){this.isSelfClosed=!!g.$empty[this.nodeName];this.isSelfClosed||(this.isSelfClosed=/\/$/.test(this.nodeName));this.closed=this.isSelfClosed},clone:function(){var a=new j,f=[];b.each(this.attributes,function(a){f.push(a.clone())});b.mix(a,{childNodes:[],firstChild:null,lastChild:null,attributes:f,nodeType:this.nodeType,nodeName:this.nodeName,tagName:this.tagName,isSelfClosed:this.isSelfClosed,
closed:this.closed,closedStartPosition:this.closedStartPosition,closedEndPosition:this.closedEndPosition});return a},setTagName:function(a){(this.nodeName=this.tagName=a)&&this._updateSelfClosed()},equals:function(a){if(!a||this.nodeName!=a.nodeName||this.nodeType!=a.nodeType||this.attributes.length!=a.attributes.length)return 0;for(var b=0;b<this.attributes.length;b++)if(!this.attributes[b].equals(a.attributes[b]))return 0;return 1},isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(a){this.childNodes.push(a);
l(this)},replace:function(a){var f=a.parentNode.childNodes,c=b.indexOf(a,f);f[c]=this;l(a.parentNode)},replaceChild:function(a,f){var c=this.childNodes,d=b.indexOf(f,c);c[d]=a;l(this)},prepend:function(a){this.childNodes.unshift(a);l(this)},insertBefore:function(a){var f=a.parentNode.childNodes,c=b.indexOf(a,f);f.splice(c,0,this);l(a.parentNode)},insertAfter:function(a){var f=a.parentNode.childNodes,c=b.indexOf(a,f);c==f.length-1?a.parentNode.appendChild(this):this.insertBefore(a.parentNode.childNodes[[c+
1]])},empty:function(){this.childNodes=[];l(this)},removeChild:function(a){var f=a.parentNode.childNodes,c=b.indexOf(a,f);f.splice(c,1);l(a.parentNode)},getAttribute:function(a){return(a=i(this.attributes,a))&&a.value},setAttribute:function(a,b){var c=i(this.attributes,a);c?c.value=b:this.attributes.push(new h(a,"=",b,'"'))},removeAttribute:function(a){(a=i(this.attributes,a))&&this.attributes.splice(b.indexOf(a,this.attributes),1)},filterChildren:function(){var a=this;if(!a.isChildrenFiltered){var d=
new (b.require("htmlparser/writer/basic"));a._writeChildrenHtml(d);d=(new (b.require("htmlparser/Parser"))(d.getHtml())).parse().childNodes;a.empty();b.each(d,function(b){a.appendChild(b)});a.isChildrenFiltered=1}},writeHtml:function(a,b){var c=this,d;d=c.tagName;if("!doctype"==d)a.append(this.toHtml()+"\n");else{c.__filter=b;c.isChildrenFiltered=0;if(b){if(!(d=b.onTagName(d)))return;c.tagName=d;d=b.onTag(c);if(!1===d)return;d&&(c=d);if(1!==c.nodeType){c.writeHtml(a,b);return}if(!c.tagName){c._writeChildrenHtml(a);
return}}a.openTag(c);for(var j=c.attributes,i=0;i<j.length;i++){var g=j[i];d=g.name;if(b){if(!(d=b.onAttributeName(d,c)))continue;g.name=d;if(!1===b.onAttribute(g,c))continue}a.attribute(g,c)}a.openTagClose(c);c.isSelfClosed||(c._writeChildrenHtml(a),a.closeTag(c))}},_writeChildrenHtml:function(a){var d=this.isChildrenFiltered?0:this.__filter;b.each(this.childNodes,function(b){b.writeHtml(a,d)})}});return j},{requires:["./Node","./Attribute","../dtd"]});
KISSY.add("htmlparser/nodes/Text",function(b,d){function h(d){b.isString(d)?(this.nodeValue=d,h.superclass.constructor.apply(this,[null,-1,-1])):(h.superclass.constructor.apply(this,arguments),this.nodeValue=this.toHtml());this.nodeType=3;this.nodeName="#text"}b.extend(h,d,{writeHtml:function(b,a){var d;if(!a||!1!==(d=a.onText(this)))d&&this!==d?d.writeHtml(b,a):b.text(this.toHtml())},toHtml:function(){return this.nodeValue?this.nodeValue:h.superclass.toHtml.apply(this,arguments)}});return h},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(b,d,h){var h=d.parseCDATA(h.quoteSmart,b.nodeName),g=d.getPosition(),a=d.nextNode();a&&(1!=a.nodeType||!(a.isEndTag()&&a.tagName==b.tagName))&&d.setPosition(g);b.closed=!0;h&&b.appendChild(h)}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(b,d,h,g){var b={scan:function(a,b,i){i=i||{};i.quoteSmart=1;d.scan(a,b,i);i.quoteSmart=0}},a;for(a in h.$cdata)g[a]=b;return b},{requires:["./CdataScanner","../dtd","./SpecialScanners"]});
KISSY.add("htmlparser/scanners/SpecialScanners",function(){return{}});
KISSY.add("htmlparser/scanners/TagScanner",function(b,d,h,g){function a(e,f){function c(){g.childNodes.length&&(g.insertAfter(p),p=g,g=e.clone())}e.closed=1;if(!f.fixByDtd)return 0;var i=1,k=[].concat(e.childNodes);b.each(k,function(a){if(!j(e,a))return i=0,!1});if(i)return 0;for(var g=e.clone(),p=e,n=[],m=0;m<k.length;m++){var r=k[m];if(j(g,r))g.appendChild(r);else if(1==r.nodeType){var s=r.tagName;if(d.$listItem[s]){c();var r=l[r.tagName],o=new h;for(o.nodeName=o.tagName=r;m<k.length;){if(k[m].tagName==
s)o.appendChild(k[m]);else if((3!=k[m].nodeType||b.trim(k[m].toHtml()))&&3==k[m].nodeType)break;m++}o.insertAfter(p);p=o;m--}else c(),r.equals(g)?(r.insertAfter(p),p=r):j(r,g)?(g=e.clone(),b.each(r.childNodes,function(a){g.appendChild(a)}),r.empty(),r.insertAfter(p),p=r,r.appendChild(g),n.push(g),g=e.clone()):(r.insertAfter(p),p=r)}}g.childNodes.length&&g.insertAfter(p);e.parentNode.removeChild(e);b.each(n,function(b){a(b,f)});return 1}function j(a,b){return 9==a.nodeType||8==b.nodeType?1:!!d[a.tagName][b.tagName||
b.nodeName]}var l={li:"ul",dt:"dl",dd:"dl"},i={dd:{dl:1},dt:{dl:1},li:{ul:1,ol:1},option:{select:1},optgroup:{select:1}};return{scan:function(b,d,c){function j(d,i){for(h=d;h>i;h--){var f=n[h];n[h-1].appendChild(f);a(f,c)}b=n[i];n.length=i}function k(a){var b=0,c;if(c=i[a.tagName]){for(var d=n.length-1,e=n[d];e&&!(e.tagName in c);){if(e.tagName==a.tagName){b=1;break}d--;e=n[d]}b&&j(n.length-1,d-1)}return b}var l,h,n;n=c.stack=c.stack||[];do{if(l=d.nextNode())if(1===l.nodeType)if(l.isEndTag()&&l.tagName==
b.tagName)l=null;else if(l.isEndTag()){if(l.isEndTag()){var m=-1;for(h=n.length-1;0<=h;h--)if(n[h].tagName===l.tagName){m=h;break}-1!=m&&(n[n.length-1].appendChild(b),a(b,c),j(n.length-1,m),l=null)}}else g[l.tagName]?(g[l.tagName].scan(l,d,c),b.appendChild(l)):l.isSelfClosed?b.appendChild(l):(n.push(b),k(l)&&n.push(b),b=l);else b.appendChild(l);null==l&&0<n.length&&(l=n[n.length-1],g[l.tagName]?l=null:(n.length-=1,l.appendChild(b),a(b,c),b=l))}while(l);a(b,c)}}},{requires:["../dtd","../nodes/Tag",
"./SpecialScanners"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(b,d,h){return h.textarea={scan:function(b,a,j){j=j||{};d.scan(b,a,j)}}},{requires:["./CdataScanner","./SpecialScanners"]});
KISSY.add("htmlparser/writer/basic",function(){function b(){this.output=[]}b.prototype={append:function(){for(var b=this.output,h=arguments,g,a=0;a<h.length;a++)if(g=h[a],1<g.length)for(var j=0;j<g.length;j++)b.push(g.charAt(j));else b.push(g);return this},openTag:function(b){this.append("<",b.tagName)},openTagClose:function(b){b.isSelfClosed&&this.append(" ","/");this.append(">")},closeTag:function(b){this.append("</",b.tagName,">")},attribute:function(b){this.append(" ",b.name,'="',(""+(b.value||
b.name)).replace(/"/g,"&quote;"),'"')},text:function(b){this.append(b)},cdata:function(b){this.append(b)},comment:function(b){this.append("<\!--"+b+"--\>")},getHtml:function(){return this.output.join("")}};return b});
KISSY.add("htmlparser/writer/beautify",function(b,d,h,g){function a(){a.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var d in b.merge(h.$nonBodyContent,h.$block,h.$listItem,h.$tableContent,{select:1,script:1,style:1}))this.setRules(d,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}b.extend(a,d,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var a=this.output;if(!this.inPre&&a.length){for(var b=a.length-1;0<=b&&/[\r\n\t ]/.test(a[b]);b--);a.length=b+1;this.append("\n")}this.allowIndent=1},setRules:function(a,d){this.rules[a]||(this.rules[a]=
{});b.mix(this.rules[a],d)},openTag:function(b){var d=this.rules[b.tagName]||{};this.allowIndent?this.indentation():d.breakBeforeOpen&&(this.lineBreak(),this.indentation());a.superclass.openTag.apply(this,arguments)},openTagClose:function(a){var b=a.tagName,d=this.rules[b]||{};a.isSelfClosed?this.append(" />"):(this.append(">"),d.allowIndent&&this.indentLevel++);d.breakAfterOpen&&this.lineBreak();"pre"===b&&(this.inPre=1)},closeTag:function(b){var d=b.tagName,i=this.rules[d]||{};i.allowIndent&&this.indentLevel--;
this.allowIndent?this.indentation():i.breakBeforeClose&&(this.lineBreak(),this.indentation());a.superclass.closeTag.apply(this,arguments);"pre"===d&&(this.inPre=0);i.breakAfterClose&&this.lineBreak()},text:function(a){this.allowIndent&&this.indentation();this.inPre||(a=g.collapseWhitespace(a));this.append(a)},comment:function(a){this.allowIndent&&this.indentation();this.append("<\!--"+a+"--\>")},cdata:function(a){this.allowIndent&&this.indentation();this.append(b.trim(a))}});return a},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(b){function d(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comment=[];this.text=[];this.cdata=[];this.attributes=[];this.root=[]}function h(a,d){for(var g=0;a&&g<a.length;g++)b.each(a[g].value,function(a){d=d.replace(a[0],a[1])});return d}function g(a,b,d,i){for(var e=0;a&&e<a.length;e++){var f;if(!1===(f=a[e].value.apply(null,b)))return!1;if(i&&f&&f!=i){if("string"==typeof f){if(i.toHtml()==f)return i;i.nodeValue=f;f=i}return this.onNode(f)}}return d}
d.prototype={addRules:function(a,b){var b=b||10,d;for(d in a)if(a.hasOwnProperty(d)){var i=this[d];if(i){var e;a:{for(e=0;i&&e<i.length;e++)if(i[e].priority>b)break a;e=i.length}i.splice(e,0,{value:a[d],priority:b})}}},onTagName:function(a){return h(this.tagNames,a)},onAttributeName:function(a){return h(this.attributeNames,a)},onText:function(a){return g.call(this,this.text,[a.toHtml(),a],a,a)},onCData:function(a){return g.call(this,this.cdata,[a.toHtml(),a],a,a)},onAttribute:function(a,b){var d;
a:{d=this.attributes;for(var i=0;d&&i<d.length;i++){var e=d[i].value,f,c=a.name;if(e[c]&&!1===(f=e[c].call(null,a.value,b))){d=f;break a}"string"==typeof f&&(a.value=f)}d=a}return d},onComment:function(a){return g.call(this,this.comment,[a.toHtml(),a],a,a)},onNode:function(a){var b=a.nodeType;if(1===b)return this.onTag(a);if(3===b)return this.onText(a);if(8===b)return this.onComment(a)},onFragment:function(a){return g.call(this,this.root,[a],a,a)},onTag:function(a){for(var b=["^",a.tagName,"$"],d=
this.tags,i,e=0;e<b.length;e++)for(var f=b[e],c=0;c<d.length;c++)if(i=d[c].value,i[f]){if(!1===(i=i[f](a)))return!1;if(i&&i!=a)return this.onNode(i);if(!a.tagName)return a}return a}};return d});
KISSY.add("htmlparser/writer/minify",function(b,d,h){function g(){g.superclass.constructor.apply(this,arguments);this.inPre=0}var a=b.trim,j=h.collapseWhitespace,l=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");b.extend(g,d,{comment:function(a){/\[if[^\]]+\]/.test(a)&&(a=a.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1"),g.superclass.comment.call(this,a))},openTag:function(a){"pre"==
a.tagName&&(this.inPre=1);g.superclass.openTag.apply(this,arguments)},closeTag:function(a){"pre"==a.tagName&&(this.inPre=0);g.superclass.closeTag.apply(this,arguments)},cdata:function(b){b=a(b).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");g.superclass.cdata.call(this,b)},attribute:function(b,d){var f=b.name,c,g=b.value||"";c=b.name;if(!(c=!a(b.value||"")?"input"===
d&&"value"===c||l.test(c):0)){c=d.nodeName;var k=b.name,h=b.value||"",h=a(h.toLowerCase());c="script"===c&&"language"===k&&"javascript"===h||"form"===c&&"method"===k&&"get"===h||"input"===c&&"type"===k&&"text"===h||"script"===c&&"type"===k&&"text/javascript"===h||"style"===c&&"type"===k&&"text/css"===h||"area"===c&&"shape"===k&&"rect"===h}if(!c)if(/^(?:checked|disabled|selected|readonly|defer|multiple|nohref|noshape|nowrap|noresize|compact|ismap)$/i.test(f))this.append(" ",f);else{c=d.nodeName;k=
b.name;h=b.value||"";/^on[a-z]+/.test(k)?h=a(h).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,""):"class"===k?h=j(a(h)):/^(?:a|area|link|base)$/.test(c)&&"href"===k||"img"===c&&/^(?:src|longdesc|usemap)$/.test(k)||"object"===c&&/^(?:classid|codebase|data|usemap)$/.test(k)||"q"===c&&"cite"===k||"blockquote"===c&&"cite"===k||("ins"===c||"del"===c)&&"cite"===k||"form"===c&&"action"===k||"input"===c&&("src"===k||"usemap"===k)||"head"===c&&"profile"===k||"script"===c&&("src"===k||"for"===
k)||/^(?:a|area|object|button)$/.test(c)&&"tabindex"===k||"input"===c&&("maxlength"===k||"tabindex"===k)||"select"===c&&("size"===k||"tabindex"===k)||"textarea"===c&&/^(?:rows|cols|tabindex)$/.test(k)||"colgroup"===c&&"span"===k||"col"===c&&"span"===k||("th"===c||"td"==c)&&("rowspan"===k||"colspan"===k)?h=a(h):"style"===k&&(h=a(h).replace(/[\s\xa0]*;[\s\xa0]*$/,""));c=(""+h).replace(/"/g,"&quote;");if(!g||/[ "'=<>`]/.test(g))c='"'+c+'"';this.append(" ",f,"=",c)}},text:function(a){this.inPre||(a=j(a));
this.append(a)}});return g},{requires:["./basic","../Utils"]});
