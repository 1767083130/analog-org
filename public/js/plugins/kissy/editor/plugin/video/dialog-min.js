/*
Copyright 2012, KISSY UI Library v1.30rc
MIT Licensed
build time: Nov 19 17:17
*/
KISSY.add("editor/plugin/video/dialog",function(f,c,i,j){function e(){e.superclass.constructor.apply(this,arguments)}f.extend(e,i,{_config:function(){var b=this.editor.get("prefixCls"),a=this.config;this._cls="ke_video";this._type="video";this._title="视频";this._bodyHtml=f.substitute("<div style='padding:20px 20px 0 20px'><p><label>链接： <input class='{prefixCls}editor-video-url {prefixCls}editor-input' style='width:410px;'/></label></p><table style='margin:10px 0 5px  40px;width:400px;'><tr><td><label>宽度：  <input  data-verify='^(自动|((?!0$)\\d+))?$'  data-warning='宽度请输入正整数' class='{prefixCls}editor-video-width {prefixCls}editor-input' style='width:60px;' /> 像素</label></td><td><label> 高度：  <input  data-verify='^(自动|((?!0$)\\d+))?$'  data-warning='高度请输入正整数' class='{prefixCls}editor-video-height {prefixCls}editor-input' style='width:60px;'/> 像素</label></td></tr><tr><td><label>对齐： <select class='{prefixCls}editor-video-align' title='对齐'><option value='none'>无</option><option value='left'>左对齐</option><option value='right'>右对齐</option></select></td><td><label>间距： <input  data-verify='^\\d+$'  data-warning='间距请输入非负整数' class='{prefixCls}editor-video-margin {prefixCls}editor-input' style='width:60px;' value='0'/> 像素</label></td></tr></table></div>",
{prefixCls:b});this._footHtml=f.substitute("<div style='padding:10px 0 35px 20px;'><a class='{prefixCls}editor-video-ok {prefixCls}editor-button ks-inline-block' style='margin-left:40px;margin-right:20px;'>确定</button> <a class='{prefixCls}editor-video-cancel {prefixCls}editor-button ks-inline-block'>取消</a></div>",{prefixCls:b});this.urlCfg=a.video&&a.video.urlCfg;this._urlTip=a.video&&a.video.urlTip||"请输入视频播放链接..."},_initD:function(){var b=this.dialog,a=this.editor.get("prefixCls"),d=b.get("el");
this.dUrl=d.one("."+a+"editor-video-url");this.dAlign=j.Select.decorate(d.one("."+a+"editor-video-align"),{prefixCls:a+"editor-big-",width:80,menuCfg:{prefixCls:a+"editor-",render:d}});this.dMargin=d.one("."+a+"editor-video-margin");this.dWidth=d.one("."+a+"editor-video-width");this.dHeight=d.one("."+a+"editor-video-height");var e=d.one("."+a+"editor-video-ok"),a=d.one("."+a+"editor-video-cancel");e.on("click",this._gen,this);a.on("click",function(a){b.hide();a.halt()});c.Utils.placeholder(this.dUrl,
this._urlTip);c.Utils.placeholder(this.dWidth,"自动");c.Utils.placeholder(this.dHeight,"自动");this.addRes(this.dAlign)},_getDInfo:function(){var b=this.dUrl.val(),a=this.config.getProvider(b);if(a){b=a.detect(b);if(!b){alert("不支持该链接，请直接输入该视频提供的分享链接");return}return{url:b,attrs:{height:parseInt(this.dHeight.val())||a.height,width:parseInt(this.dWidth.val())||a.width,style:"margin:"+(parseInt(this.dMargin.val())||0)+"px;float:"+this.dAlign.get("value")+";"}}}alert("不支持该链接来源!")},_gen:function(b){var a=this,
d=a.dUrl.val(),c=a.urlCfg;if(c)for(var g=0;g<c.length;g++){var h=c[g];if(h.reg.test(d)){a.dialog.loading();b={};b[h.paramName||"url"]=d;f.io({url:h.url,data:b,dataType:"jsonp",success:function(b){a._dynamicUrlPrepare(b[1])}});return}}e.superclass._gen.call(a);b&&b.halt()},_dynamicUrlPrepare:function(b){this.dUrl.val(b);this.dialog.unloading();e.superclass._gen.call(this)},_updateD:function(){var b=this.editor,a=this.selectedFlash;a?(b=b.restoreRealElement(a),c.Utils.valInput(this.dUrl,this._getFlashUrl(b)),
this.dAlign.set("value",a.css("float")),this.dMargin.val(parseInt(b.style("margin"))||0),c.Utils.valInput(this.dWidth,parseInt(a.css("width"))),c.Utils.valInput(this.dHeight,parseInt(a.css("height")))):(c.Utils.resetInput(this.dUrl),this.dAlign.set("value","none"),this.dMargin.val(0),c.Utils.resetInput(this.dWidth),c.Utils.resetInput(this.dHeight))}});return e},{requires:["editor","../flash/dialog","../menubutton/"]});
